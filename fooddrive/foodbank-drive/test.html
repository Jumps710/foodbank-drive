<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOFF Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-panel {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .big-text {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-align: center;
            margin: 20px 0;
        }
        .info-box {
            background: #e1f5fe;
            padding: 15px;
            border-left: 4px solid #0288d1;
            margin: 10px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #45a049;
        }
        .debug-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="big-text">ğŸ” WOFF Connection Test</div>
    
    <div class="test-panel">
        <h2>Basic Environment Check</h2>
        <div class="info-box" id="basicInfo">Checking...</div>
    </div>

    <div class="test-panel">
        <h2>WOFF URL Analysis</h2>
        <button onclick="analyzeWOFFURL()">WOFF URL è§£æ</button>
        <button onclick="testWOFFRedirect()">ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ†ã‚¹ãƒˆ</button>
        <div class="info-box" id="woffInfo">ã‚¯ãƒªãƒƒã‚¯ã—ã¦è§£æé–‹å§‹</div>
    </div>

    <div class="test-panel">
        <h2>Debug Log</h2>
        <div class="debug-output" id="debugLog"></div>
    </div>

    <script>
        // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('debugLog');
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        // åŸºæœ¬ç’°å¢ƒæƒ…å ±ã‚’è¡¨ç¤º
        function showBasicInfo() {
            const userAgent = navigator.userAgent;
            const referrer = document.referrer;
            const url = window.location.href;
            
            const basicInfo = `
                <strong>Current URL:</strong> ${url}<br>
                <strong>Referrer:</strong> ${referrer || 'None'}<br>
                <strong>User Agent:</strong> ${userAgent.includes('WORKS') ? 'âœ… LINE WORKS' : 'âŒ Not LINE WORKS'}<br>
                <strong>Is WOFF Referrer:</strong> ${referrer.includes('woff.worksmobile.com') ? 'âœ… Yes' : 'âŒ No'}<br>
                <strong>Protocol:</strong> ${window.location.protocol}<br>
                <strong>Host:</strong> ${window.location.host}
            `;
            
            document.getElementById('basicInfo').innerHTML = basicInfo;
            
            addLog('Basic info displayed');
            addLog(`URL: ${url}`);
            addLog(`Referrer: ${referrer}`);
            addLog(`UA Contains WORKS: ${userAgent.includes('WORKS')}`);
        }

        // WOFF URL è§£æ
        function analyzeWOFFURL() {
            addLog('=== WOFF URL Analysis Started ===');
            
            const woffURL = 'https://woff.worksmobile.com/woff/Bv2kAkzN6gcZ0nD0brpMpg';
            const endpointURL = 'https://jumps710.github.io/foodbank-drive/index.html';
            
            addLog(`Expected WOFF URL: ${woffURL}`);
            addLog(`Expected Endpoint: ${endpointURL}`);
            addLog(`Current URL: ${window.location.href}`);
            addLog(`Current Referrer: ${document.referrer}`);
            
            // URLæ¯”è¼ƒ
            if (window.location.href.includes('jumps710.github.io')) {
                addLog('âœ… Currently on GitHub Pages');
                
                if (document.referrer.includes('woff.worksmobile.com')) {
                    addLog('âœ… Referred from WOFF URL - This is correct!');
                    document.getElementById('woffInfo').innerHTML = 'âœ… <strong>æ­£å¸¸ãªWOFFã‚¢ã‚¯ã‚»ã‚¹</strong><br>WOFF URLã‹ã‚‰ã®æ­£å½“ãªãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§ã™ã€‚';
                } else {
                    addLog('âš ï¸ Not referred from WOFF URL - Direct access?');
                    document.getElementById('woffInfo').innerHTML = 'âš ï¸ <strong>ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹</strong><br>WOFF URLçµŒç”±ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
                }
            } else {
                addLog('âŒ Not on expected domain');
                document.getElementById('woffInfo').innerHTML = 'âŒ <strong>äºˆæœŸã—ãªã„ãƒ‰ãƒ¡ã‚¤ãƒ³</strong><br>æƒ³å®šå¤–ã®URLã§ã™ã€‚';
            }
        }

        // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ†ã‚¹ãƒˆ
        function testWOFFRedirect() {
            addLog('=== Redirect Test Started ===');
            addLog('This would normally test redirect behavior');
            
            // å®Ÿéš›ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ†ã‚¹ãƒˆã¯å±é™ºãªã®ã§æƒ…å ±è¡¨ç¤ºã®ã¿
            const info = `
                <strong>ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ†ã‚¹ãƒˆæƒ…å ±:</strong><br>
                â€¢ WOFF URLã«ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã€è‡ªå‹•çš„ã«Endpoint URLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã¯ãšã§ã™<br>
                â€¢ ã‚‚ã—LINE WORKSãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‹ã‚‰å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã«é£›ã¶å ´åˆã€è¨­å®šã«å•é¡ŒãŒã‚ã‚Šã¾ã™<br>
                â€¢ ç¾åœ¨ã®Referrerã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã€æ­£ã—ããƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚ŒãŸã‹ã‚ã‹ã‚Šã¾ã™
            `;
            
            document.getElementById('woffInfo').innerHTML = info;
            addLog('Redirect test info displayed');
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åŸºæœ¬æƒ…å ±ã‚’è¡¨ç¤º
        window.addEventListener('load', () => {
            addLog('=== Page Loaded ===');
            showBasicInfo();
        });
    </script>
</body>
</html>