<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOFF Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-panel {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .big-text {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-align: center;
            margin: 20px 0;
        }
        .info-box {
            background: #e1f5fe;
            padding: 15px;
            border-left: 4px solid #0288d1;
            margin: 10px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #45a049;
        }
        .debug-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="big-text">🔍 WOFF Connection Test</div>
    
    <div class="test-panel">
        <h2>Basic Environment Check</h2>
        <div class="info-box" id="basicInfo">Checking...</div>
    </div>

    <div class="test-panel">
        <h2>WOFF URL Analysis</h2>
        <button onclick="analyzeWOFFURL()">WOFF URL 解析</button>
        <button onclick="testWOFFRedirect()">リダイレクトテスト</button>
        <div class="info-box" id="woffInfo">クリックして解析開始</div>
    </div>

    <div class="test-panel">
        <h2>Debug Log</h2>
        <div class="debug-output" id="debugLog"></div>
    </div>

    <script>
        // ログ出力関数
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('debugLog');
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        // 基本環境情報を表示
        function showBasicInfo() {
            const userAgent = navigator.userAgent;
            const referrer = document.referrer;
            const url = window.location.href;
            
            const basicInfo = `
                <strong>Current URL:</strong> ${url}<br>
                <strong>Referrer:</strong> ${referrer || 'None'}<br>
                <strong>User Agent:</strong> ${userAgent.includes('WORKS') ? '✅ LINE WORKS' : '❌ Not LINE WORKS'}<br>
                <strong>Is WOFF Referrer:</strong> ${referrer.includes('woff.worksmobile.com') ? '✅ Yes' : '❌ No'}<br>
                <strong>Protocol:</strong> ${window.location.protocol}<br>
                <strong>Host:</strong> ${window.location.host}
            `;
            
            document.getElementById('basicInfo').innerHTML = basicInfo;
            
            addLog('Basic info displayed');
            addLog(`URL: ${url}`);
            addLog(`Referrer: ${referrer}`);
            addLog(`UA Contains WORKS: ${userAgent.includes('WORKS')}`);
        }

        // WOFF URL 解析
        function analyzeWOFFURL() {
            addLog('=== WOFF URL Analysis Started ===');
            
            const woffURL = 'https://woff.worksmobile.com/woff/Bv2kAkzN6gcZ0nD0brpMpg';
            const endpointURL = 'https://jumps710.github.io/foodbank-drive/index.html';
            
            addLog(`Expected WOFF URL: ${woffURL}`);
            addLog(`Expected Endpoint: ${endpointURL}`);
            addLog(`Current URL: ${window.location.href}`);
            addLog(`Current Referrer: ${document.referrer}`);
            
            // URL比較
            if (window.location.href.includes('jumps710.github.io')) {
                addLog('✅ Currently on GitHub Pages');
                
                if (document.referrer.includes('woff.worksmobile.com')) {
                    addLog('✅ Referred from WOFF URL - This is correct!');
                    document.getElementById('woffInfo').innerHTML = '✅ <strong>正常なWOFFアクセス</strong><br>WOFF URLからの正当なリダイレクトです。';
                } else {
                    addLog('⚠️ Not referred from WOFF URL - Direct access?');
                    document.getElementById('woffInfo').innerHTML = '⚠️ <strong>直接アクセス</strong><br>WOFF URL経由ではありません。';
                }
            } else {
                addLog('❌ Not on expected domain');
                document.getElementById('woffInfo').innerHTML = '❌ <strong>予期しないドメイン</strong><br>想定外のURLです。';
            }
        }

        // リダイレクトテスト
        function testWOFFRedirect() {
            addLog('=== Redirect Test Started ===');
            addLog('This would normally test redirect behavior');
            
            // 実際のリダイレクトテストは危険なので情報表示のみ
            const info = `
                <strong>リダイレクトテスト情報:</strong><br>
                • WOFF URLにアクセス時、自動的にEndpoint URLにリダイレクトされるはずです<br>
                • もしLINE WORKSモバイルアプリから外部ブラウザに飛ぶ場合、設定に問題があります<br>
                • 現在のReferrerを確認することで、正しくリダイレクトされたかわかります
            `;
            
            document.getElementById('woffInfo').innerHTML = info;
            addLog('Redirect test info displayed');
        }

        // ページ読み込み時に基本情報を表示
        window.addEventListener('load', () => {
            addLog('=== Page Loaded ===');
            showBasicInfo();
        });
    </script>
</body>
</html>